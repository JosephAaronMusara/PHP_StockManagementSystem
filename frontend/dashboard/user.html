<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cahe"/>
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User-Stock Management</title>
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <script>
          const logged = JSON.parse(localStorage.getItem('isActive'));
          if (!logged) {
              window.location.href = '../authentication/login.html';
          }
  </script>
    <div class="sidenav">
      <a href="#stock-management" onclick="showSection('stock-management')">Stock Management</a>
      <a href="#alerts" onclick="showSection('alerts')">Alerts</a>
      <a href="#purchase-orders" onclick="showSection('purchase-orders')">Purchase Orders</a>
      <a href="#sales" onclick="showSection('sales')">Sales</a>
      <a href="#suppliers" onclick="showSection('suppliers')">Suppliers</a>
      <a href="#transactions" onclick="showSection('transactions')">Transactions</a>
      <a href="#settings" onclick="showSection('settings')">Settings</a>
      <li><button id="logout-btn">Logout</button></li>
    </div>

    <div class="dashboard-container">
      <header class="dashboard-header">
        <h1>User Stock Management</h1>
        <div class="user-info">
          <span id="welcomeSpan"></span>
        </div>
      </header>

      <main class="dashboard-content">
        <!-- Stock Management -->
        <section id="stock-management" class="section active">
          <h2>Manage Stock</h2>
          <button id="addStockButton" class="button">Add New Stock</button>
          <table class="stock-table">
            <thead>
              <tr>
                <th>Item Name</th>
                <th>Category</th>
                <th>Quantity</th>
                <th>Purchase Price</th>
                <th>Selling Price</th>
                <th>Supplier</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="stockTableBody">
              <!-- .................... -->
            </tbody>
          </table>
        </section>

        <!-- Alerts -->
        <section id="alerts" class="section">
          <h2>Alerts</h2>
          <table class="alerts-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Alert Type</th>
                <th>Item Name</th>
                <th>Message</th>
                <!-- Alerts are read only. I want them to be auto generated by the system -->
                <!-- <th>Actions</th> -->
              </tr>
            </thead>
            <tbody id="alertsTableBody">
              <!-- .................... -->
            </tbody>
          </table>
        </section>

        <!-- Purchase Orders -->
        <section id="purchase-orders" class="section">
          <h2>Purchase Orders</h2>
          <button id="addPOrderButton" class="button">Add New Purchase Order</button>
          <table class="porder-table">
            <thead>
              <tr>
                <th>Supplier</th>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total Amount</th>
                <th>Time Received</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="porderTableBody">
              <!-- .................... -->
            </tbody>
          </table>
        </section>

        <!-- Sales -->
        <section id="sales" class="section">
          <h2>Manage Sales</h2>
          <button id="addSaleButton" class="button">Record New Sale</button>
          <table class="sales-table">
            <thead>
              <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total Amount</th>
                <th>Time of Sale</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="salesTableBody">
              <!-- .................... -->
            </tbody>
          </table>
        </section>

        <!-- Suppliers -->
        <section id="suppliers" class="section">
          <h2>Manage Suppliers</h2>
          <button id="addSupplierButton" class="button">
            Add New Supplier
          </button>
          <table class="supplier-table">
            <thead>
              <tr>
                <th>Supplier Name</th>
                <th>Contact Information</th>
                <th>Postal Address</th>
                <th>Registration Time</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="supplierTableBody">
              <!-- .................... -->
            </tbody>
          </table>
        </section>

        <!-- Transactions -->
        <section id="transactions" class="section">
          <h2>Manage Transactions</h2>
          <!-- <button id="addTransactionButton" class="button">Add New Stock</button> -->
          <!-- I dont see the reason to manipulate transaction lol. For data integrity -->
          <table class="transactions-table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Item Name</th>
                <th>User</th>
                <th>Quantity</th>
                <th>Transaction Time</th>
              </tr>
            </thead>
            <tbody id="transactionTableBody">
              <!-- .................... -->
            </tbody>
          </table>
        </section>

        <!-- Settings -->
        <section id="settings" class="section">
          <h2>Settings</h2>

          <!-- User Details Form -->
          <div class="settings-section">
            <h3>Update User Details</h3>
            <form id="userDetailsForm">
              <label for="userName">Name:</label>
              <input type="text" id="userName" name="username" placeholder="Your Name" required />
              <label for="userEmail">Email:</label>
              <input type="email" id="userEmail" name="email" placeholder="Your Email" required />
              <label for="userPassword">Password:</label>
              <input type="password" id="userPassword" name="password" placeholder="New Password" />
              <label for="userPassword">Password:</label>
              <input type="password" id="confirmUserPassword" name="confirm_password" placeholder="Confirm Password" />
              <button type="submit" class="button">Update Details</button>
            </form>
          </div>

          <!-- Theme -->
          <div class="settings-section">
            <h3>Change Theme</h3>
            <label for="themeSelect">Select Theme:</label>
            <select id="themeSelect">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
            <button id="applyThemeButton" class="button">Apply Theme</button>
          </div>
        </section>
      </main>
    </div>

    <div id="stockModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modalTitle">Add New Stock</h2>
        <form id="stockForm">
          <input type="hidden" id="stockId" />
          <input type="text" id="itemName" name="name" placeholder="Item Name" required/>
          <select name="category_id" id="category" style="padding: 5px; width: calc(100% - 20px)"></select>
          <input type="number" name="quantity" id="quantity" placeholder="Quantity" required/>
          <input type="number" name="purchase_price" id="purchasePrice" placeholder="Purchase Price" required/>
          <input type="number" name="selling_price" id="sellingPrice" placeholder="Selling Price" required/>
          <select name="supplier_id" id="supplier" style="padding: 5px; width: calc(100% - 20px)"></select>
          <button id="submitBtn" type="submit" class="button">Save Stock</button>
        </form>
      </div>
    </div>

    <div id="porderModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modalTitle">Add New Purchase</h2>
        <form id="porderForm">
          <input type="hidden" id="porderId" />
          <input type="hidden" name="user_id" id="userIdPO" />
          <select name="supplier_id" id="supplierPO" style="padding: 5px; width: calc(100% - 20px)"></select>
          <select name="stock_item_id" id="itemNamePO" style="padding: 5px; width: calc(100% - 20px)"></select>           
          <input type="number" name="quantity" id="quantityPO" placeholder="Quantity" required/>
          <input type="number" name="unit_price" id="unitPricePO" placeholder="Unit Price" required/>
          <input type="number" name="total_amount" id="totalAmountPO" placeholder="Total Amount" readonly required/>
          <input type="text" id="time_received" name="received_at" placeholder="Time Received" required/>
          <button id="submitBtnPO" type="submit" class="button">Save Purchase Order</button>
        </form>
      </div>
    </div>

    <div id="salesModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modalTitle">Add New Sale</h2>
        <form id="salesForm">
          <input type="hidden" id="salesId" />
          <input type="hidden" name="user_id" id="userIdSale" />
          <select name="stock_item_id" id="itemNameSale" style="padding: 5px; width: calc(100% - 20px)"></select>          
          <input type="number" name="quantity" id="quantitySale" placeholder="Quantity" required/>
          <input type="number" name="unit_price" id="unitPriceSale" placeholder="Unit Price" readonly required/>
          <input type="number" name="total_amount" id="totalAmountSale" placeholder="Total Amount" readonly required/>
          <button id="submitBtnSale" type="submit" class="button">Record Sale</button>
        </form>
      </div>
    </div>

    <div id="supplierModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modalTitle">Add New Supplier</h2>
        <form id="supplierForm">
          <input type="hidden" id="supplierId" />
          <input type="text" id="itemNameSupplier" name="name" placeholder="Supplier Name" required/>
          <input type="text" name="contact_info" id="contact_info" placeholder="Contact Information" required/>
          <input type="text" name="postal_address" id="postal_address" placeholder="Postal Address" required/>
          <button id="submitBtnSupplier" type="submit" class="button">Save Supplier</button>
        </form>
      </div>
    </div>

    <script src="../js/userscript.js"></script>
    <script src="../js/purchaseOrders.js"></script>
    <script src="../js/suppliers.js"></script>
    <script src="../js/usersettings.js"></script>
    <script src="../js/sales.js"></script>

    <script>
      // sec js
      function showSection(sectionId) {
        const sections = document.querySelectorAll(".section");
        sections.forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(sectionId).classList.add("active");
      }
    </script>
    <!-- <button id="logout-btn">Logout</button> -->

<script>
    document.getElementById('logout-btn').addEventListener('click', async function () {
        const response = await fetch('http://localhost/StockManagementSystem/api/endpoints/user.php?action=logout', {
            method: 'POST',
        });
        const result = await response.json();
        if (result.success) {
            alert('Logged out successfully');
            window.location.href = 'http://localhost/StockManagementSystem/frontend/authentication/login.html';  // Redirect to login
        }
    });
</script>

  </body>
</html>
